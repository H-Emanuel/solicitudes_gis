{% load static %}

<!DOCTYPE html>
<html lang="es" class="h-100">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Departamento SIG - Control Usuario</title>


    <!-- Ícono de pestaña -->
    <link rel="icon" type="image/x-icon" href="/media/assets/image/iconoSIG.ico" />

    <!-- Estilos personalizados -->
    <link href="{% static 'css/base.css' %}" rel="stylesheet" />
    <link href="{% static 'css/slide.css' %}" rel="stylesheet" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>

    <!-- jQuery (debe ir antes que Select2 y DataTables) -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.0.0/dist/select2-bootstrap-5.min.css" rel="stylesheet" />

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" />
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Fonts: Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=swap" rel="stylesheet" />

{% block custom_css %}
    <style>
      #form-container {
        width: 800px; /* O usa width: 80%; para un ancho relativo */
        margin: 0 auto; /* Centrar el contenedor horizontalmente */
        background-color: #e7e7e7;
        box-shadow: 1px 2px 16px rgba(0, 0, 0, 0.9);
        padding: 1px;
        border-radius: 5px;
    }
  
    </style>
    {% endblock %}
  </head>
  <body class="d-flex flex-column h-100" style="overflow-x: hidden;">
    <nav class="navbar navbar-expand-sm navbar-dark bg-neumorphic navbar-custom" aria-label="Third navbar example">
      <a href="https://municipalidaddevalparaiso.cl/"><img src="https://departamentosig.munivalpo.cl/media/assets/imagen_sig/None/adjunto_jOZmpn7.png" height="100" alt="Caluga Administrativa" /></a>
     <a href="{% url 'inicio' %}"><img src="/media/assets/image/version-color-corporativo-caluga-logoSIG.png" alt="Logo SIG" height="100" /></a> 
      <div class="container-fluid">
        <p class="navbar-brand" href="{% url 'control' %}">INTERNO</p>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample03" aria-controls="navbarsExample03" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarsExample03">
          {% if request.user.is_authenticated %}

          <ul class="navbar-nav col-lg-10 justify-content-lg-center">
       
            <li class="nav-link">
              <a class="nav-link" href="{% url 'solicitude_llegadas' %}">Solicitudes </a>
            </li>
            <li class="nav-link">
              <a class="nav-link" href="/tareas/">Tareas SIG</a>
            </li>
            <li class="nav-link">
              <a class="nav-link" href="{% url 'control' %}">Estadísticas</a>
            </li>
         
          </ul>


         

          <div class="d-lg-flex col-lg-3 justify-content-lg-end">
            <ul class="navbar-nav me-auto mb-2 mb-sm-0">

              <li class="nav-item dropdown">
  
                <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="height: 40px;">
                    <!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"/>
                  </svg>
                </a>
  
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="{% url 'solicitude_llegadas' %}">Solicitudes</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'Historial_Visitas' %}">Historial usuarios</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'Gestion_imagen' %}">Gestion de imagenes SIG</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'Gestion_pdf' %}">Gestion de PDF SIG</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/survey/">Survey</a>
                  </li>
  
                  <li>
                    <a class="dropdown-item" href="{% url 'cambiar_contraseña' %}">Cambiar Contraseña</a>
                  </li>

  
                    {% if request.user.is_staff and request.user.is_authenticated %}
                      <li>
                        <a class="dropdown-item" href="{% url 'delegar_admin' %}">Asignar ADMIN</a>
                      </li>
                    {% endif %}
          
                    <li>
                      <a class="dropdown-item" href="{% url 'core_logout' %}">Cerrar Sesión</a>
                    </li>
            </li>
  
            </ul>

          </div>
          {% endif %}

        </div>
      </div>
    </nav>
    {% block main_content %}

    {% endblock %}



    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>



    <!-- Custom JS -->
    {% block custom_js %}

    {% endblock %}

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Solicitud Express</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body ">
            
            <div id="form-container" class="mx-auto p-1 border-1 rounded" style="background-color: #e7e7e7; box-shadow: 1px 2px 16px rgba(0, 0, 0, 0.9);">

              <form method='POST' id="form-guardar-pdf" class="px-3" enctype="multipart/form-data" action="{% url 'crear_protocolo' %}">
                  {% csrf_token %}
                  <h3 class="text-center mb-4" style="color:#000000; margin-top: 20px">Formulario de Protocolo</h3>
  
                  <!-- Campos de formulario -->
                  <div class="form-group mb-3">
                    <label for="direccion">Dirección</label>
                    <select name="direccion" class="form-control" id="id_direccion">
                      <option value="" selected=""></option>

                      <option value="Dirección de Vivienda, Barrio y Territorio">Dirección de Vivienda, Barrio y Territorio</option>

                      <option value="Gabinete">Gabinete</option>

                      <option value="Dirección de Medioambiente">Dirección de Medioambiente</option>

                      <option value="Dirección de Administración y Finanzas">Dirección de Administración y Finanzas</option>

                      <option value="Dirección desarrollo Económico y Cooperación Internacional">Dirección desarrollo Económico y Cooperación Internacional</option>

                      <option value="Administración Municipal">Administración Municipal</option>

                      <option value="Dirección de Operaciones">Dirección de Operaciones</option>

                      <option value="Dirección de Desarrollo Comunitario">Dirección de Desarrollo Comunitario</option>

                      <option value="Dirección de Tránsito y Transporte públicos">Dirección de Tránsito y Transporte públicos</option>

                      <option value="Dirección de Seguridad Ciudadana">Dirección de Seguridad Ciudadana</option>

                      <option value="Dirección de Obras Municipales">Dirección de Obras Municipales</option>

                      <option value="Dirección de Desarrollo Cultural">Dirección de Desarrollo Cultural</option>

                      <option value="Dirección de Género, Mujeres y Diversidades">Dirección de Género, Mujeres y Diversidades</option>

                      <option value="SECPLA">SECPLA</option>

                      <option value="Alcaldía">Alcaldía</option>

                      <option value="Dirección de Asesoría Jurídica">Dirección de Asesoría Jurídica</option>

                      <option value="Juzgados">Juzgados</option>

                      <option value="Delegación territorial">Delegación territorial</option>
                      
                      <option value="Otros">Otros</option>

                    </select>
                  </div>
                  
                <div class="form-group mb-3">
                  <label for="departamento">Departamento o Unidad responsable</label>
                  <input type="text" name="departamento" class="form-control " maxlength="100" required="" id="id_departamento">
                </div>
                  
                <div class="form-group mb-3">
                    <label for="nombre_solicitante">Nombre del solicitante</label>
                    <input type="text" name="nombre_solicitante" class="form-control " maxlength="255" required="" id="id_nombre_solicitante">
                </div>
                  
                <div class="form-group mb-3">
                    <label for="nombre_proyecto">Nombre del proyecto</label>
                    <input type="text" name="nombre_proyecto" class="form-control " maxlength="255" required="" id="id_nombre_proyecto">
                </div>
                  
                <div class="form-group mb-3">
                  <label for="corre_solicitante">Correo del solicitante</label>
                  <input type="email" name="corre_solicitante" class="form-control " maxlength="320" required="" id="id_corre_solicitante">
                </div>
                  
                <div class="form-group mb-3">
                    <label for="area">Área de estudio o intervencion(Cerro,Sector,UV,ect.)</label>
                    <input type="text" name="area" class="form-control " maxlength="50" required="" id="id_area">
                </div>
                  
              <div class="form-group mb-3">
                  <label for="objetivos">Objetivos de las solicitud</label>
                  <textarea name="objetivos" cols="40" rows="10" class="form-control " required="" id="id_objetivos"></textarea>
              </div>
                  
              <div class="form-group mb-3">
                <label for="insumo">Insumo:</label>
                <select name="insumo" class="select2 form-control" multiple="multiple" id="insumo">
                    <option value="insumo_1">Planos Impresos</option>
                    <option value="insumo_2">Planos Digital </option>
                    <option value="insumo_3">Excel</option>
                    <option value="insumo_4">Cuadro de Mando </option>
                    <option value="insumo_5">Aplicación</option>
                    <option value="insumo_6">KMZ</option>
                    <option value="insumo_7">Shape</option>
                    <option value="insumo_8">CAD</option>
                    <option value="insumo_9">Formulario Digital</option>
                    <option value="insumo_10">Web Experience</option>
                    <option value="insumo_11">Story Maps</option>
                    <option value="insumo_12">Plataforma</option>
                    <option value="insumo_13">Estudios y otros </option>
                    <option value="insumo_14">Soporte Web </option>
                    <option value="insumo_15">Plataforma Web</option>
                </select>
            </div>

            <div class="form-group mb-3">
              <label for="anexo">anexo</label>
              <input type="text" name="anexo" class="form-control " maxlength="255" required="" id="anexo">
            </div>
          
              
            <div class="form-group mb-3">
              <label for="cambios_posible">Posibles cambios en el insumo Entregado</label>
              <input type="text" name="cambios_posible" class="form-control " maxlength="255" required="" id="id_cambios_posible">
            </div>
  
                  <!-- Archivo adjunto -->
                  <div class="form-group mb-4">
                      <label for="archivo"><strong>Adjuntar Archivos (máx. 300MB)</strong></label>
                      <input type="file" name="archivo" multiple="multiple" class="form-control" id="archivo">
                  </div>
  
  
                  <div class="text-center">
                      <button type="submit" id="btn-guardar-pdf" class="pushable enviado" style="width: auto;">
                      
                        <span>Enviar <span class="material-symbols-outlined">
                          forward_to_inbox                      </button>
                  </div>    
                                      
                  <!-- Mensaje de información -->
                  
              </form>
          </div>
         </div>


        </div>
      </div>
    </div>
    <script>
      $(document).ready(function(){
          $("#form-guardar-pdf").submit(function(event){
              event.preventDefault(); // Evita el envío tradicional del formulario
      
              let formData = new FormData(this);
      
              $.ajax({
                  url: "{% url 'solicitud_express' %}",
                  type: "POST",
                  data: formData,
                  processData: false,
                  contentType: false,
                  beforeSend: function() {
                      $("#btn-guardar-pdf").prop("disabled", true).text("Enviando...");
                  },
                  success: function(response) {
                      if (response.success) {
                          alert("Solicitud enviada correctamente");
      
                          // Limpia todos los campos del formulario
                          $("#form-guardar-pdf")[0].reset();
      
                          // Si hay select, restablecerlos a la opción por defecto
                          $("#form-guardar-pdf select").prop("selectedIndex", 0);
      
                          // Cerrar el modal
                          $("#exampleModal").modal('hide');
                      } else {
                          alert("Error: " + response.message);
                      }
                  },
                  error: function(xhr, status, error) {
                      alert("Error en la solicitud: " + error);
                  },
                  complete: function() {
                      $("#btn-guardar-pdf").prop("disabled", false).text("Enviar");
                  }
              });
          });
      
          // Resetea el formulario cuando el modal se cierre manualmente
          $('#exampleModal').on('hidden.bs.modal', function () {
              $("#form-guardar-pdf")[0].reset();
              $("#form-guardar-pdf select").prop("selectedIndex", 0);
          });
      });
      </script>
      <!-- jQuery -->

      <!-- Select2 CSS -->
      <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

      <!-- Select2 JS -->
      <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

 
      
      <script>
        $('#exampleModal').on('shown.bs.modal', function () {
          $('.select2').select2({
            dropdownParent: $('#exampleModal')
          });
        });
      
        // Evita que Select2 cierre el modal al hacer clic
        $('#exampleModal').on('select2:opening select2:closing', function (e) {
          e.stopPropagation();
        });
      </script>
  </body> 
</html>
